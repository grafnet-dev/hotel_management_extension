<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Vue liste pour hotel.room.pricing -->
    <record id="view_hotel_room_pricing_list" model="ir.ui.view">
        <field name="name">hotel.room.pricing.list</field>
        <field name="model">hotel.room.pricing</field>
        <field name="arch" type="xml">
            <list string="Tarifications par Type" editable="bottom" create="true" delete="true">
                <field name="room_id" readonly="1"/>
                <field name="reservation_type_id" 
                       string="Type de R√©servation"
                       options="{'no_create_edit': True}" 
                       required="1"/>
                <field name="price" 
                       string="Prix de Base"
                       widget="monetary" 
                       options="{'currency_field': 'currency_id'}"/>
                <field name="is_hourly_based" 
                       string="Tarif Horaire" 
                       readonly="1"/>
                <field name="hourly_price" 
                       string="Prix/Heure"
                       widget="monetary" 
                       options="{'currency_field': 'currency_id'}"
                       column_invisible="not is_hourly_based"/>
                <field name="currency_id" column_invisible="1"/>
            </list>
        </field>
    </record>

    <!-- Vue formulaire pour hotel.room.pricing -->
    <record id="view_hotel_room_pricing_form" model="ir.ui.view">
        <field name="name">hotel.room.pricing.form</field>
        <field name="model">hotel.room.pricing</field>
        <field name="arch" type="xml">
            <form string="Tarification Chambre">
                <sheet>
                    <group>
                        <group string="Informations G√©n√©rales">
                            <field name="room_id" options="{'no_create_edit': True}"/>
                            <field name="reservation_type_id" 
                                   options="{'no_create_edit': True}" 
                                   required="1"/>
                            <field name="currency_id" groups="base.group_multi_currency"/>
                        </group>
                        <group string="Tarification">
                            <field name="price" 
                                   string="Prix de Base"
                                   widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"/>
                            <field name="is_hourly_based" readonly="1"/>
                            <field name="hourly_price" 
                                   string="Prix par Heure"
                                   widget="monetary" 
                                   options="{'currency_field': 'currency_id'}"
                                   invisible="not is_hourly_based"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Vue recherche pour hotel.room.pricing -->
    <record id="view_hotel_room_pricing_search" model="ir.ui.view">
        <field name="name">hotel.room.pricing.search</field>
        <field name="model">hotel.room.pricing</field>
        <field name="arch" type="xml">
            <search string="Rechercher Tarifications">
                <field name="room_id" string="Chambre"/>
                <field name="reservation_type_id" string="Type de R√©servation"/>
                <field name="price" string="Prix"/>
                
                <!-- Filtres -->
                <filter name="with_hourly_rate" 
                        string="Avec Tarif Horaire" 
                        domain="[('is_hourly_based', '=', True)]"/>
                <filter name="without_hourly_rate" 
                        string="Sans Tarif Horaire" 
                        domain="[('is_hourly_based', '=', False)]"/>
                
                <!-- Groupement -->
                <group expand="0" string="Grouper Par">
                    <filter name="group_by_room" 
                            string="Chambre" 
                            context="{'group_by': 'room_id'}"/>
                    <filter name="group_by_type" 
                            string="Type de R√©servation" 
                            context="{'group_by': 'reservation_type_id'}"/>
                    <filter name="group_by_currency" 
                            string="Devise" 
                            context="{'group_by': 'currency_id'}"
                            groups="base.group_multi_currency"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action pour hotel.room.pricing -->
    <record id="action_hotel_room_pricing" model="ir.actions.act_window">
        <field name="name">Tarifications Chambres</field>
        <field name="res_model">hotel.room.pricing</field>
        <field name="view_mode">list,form</field>
        <field name="search_view_id" ref="view_hotel_room_pricing_search"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Cr√©er une nouvelle tarification
            </p>
            <p>
                D√©finissez les prix pour chaque type de r√©servation par chambre.
                Les tarifs horaires sont automatiquement activ√©s pour les types flexibles.
            </p>
        </field>
    </record>

 
    <!-- H√©ritage de la vue formulaire hotel.room pour ajouter l'onglet tarification -->
    <record id="view_form_hotel_room_inherit_pricing" model="ir.ui.view">
        <field name="name">hotel.room.view.form.inherit.pricing</field>
        <field name="model">hotel.room</field>
        <field name="inherit_id" ref="hotel_management_odoo.hotel_room_view_form"/>
        <field name="arch" type="xml">
            <xpath expr="//notebook" position="inside">
                <!-- üí∞ Onglet Tarification -->
                <page string="Tarification" name="pricing">
                    <group>
                        <group string="Tarifs par Type de R√©servation">
                            <field name="room_pricing_ids" nolabel="1">
                                <list editable="bottom" create="true" delete="true">
                                    <field name="reservation_type_id" 
                                           string="Type de R√©servation"
                                           domain="[('id', 'in', parent.reservation_type_ids)]"
                                           required="1"
                                           options="{'no_create_edit': True}"/>
                                    <field name="price" 
                                           string="Prix de Base"
                                           widget="monetary"
                                           options="{'currency_field': 'currency_id'}"/>
                                    <field name="is_hourly_based" 
                                           string="Tarif Horaire"
                                           readonly="1"/>
                                    <field name="hourly_price" 
                                           string="Prix/Heure"
                                           widget="monetary"
                                           options="{'currency_field': 'currency_id'}"
                                           column_invisible="not is_hourly_based"/>
                                    <field name="currency_id" column_invisible="1"/>
                                </list>
                            </field>
                        </group>
                    </group>
                    
                    <!-- Actions rapides -->
                    <div class="oe_button_box" name="button_box">
                        <button name="%(action_hotel_room_pricing)d" 
                                type="action" 
                                class="oe_stat_button" 
                                icon="fa-money"
                                context="{'default_room_id': id, 'search_default_group_by_type': 1}">
                            <field name="room_pricing_ids" widget="statinfo" string="Tarifications"/>
                        </button>
                    </div>
                    
                    <!-- Message d'information pour les tarifs -->
                    <div class="alert alert-info" role="alert" style="margin-top: 15px;">
                        <strong>‚ÑπÔ∏è Information Tarification :</strong><br/>
                        ‚Ä¢ <strong>Prix de Base</strong> : Prix fixe ou prix de base selon le type<br/>
                        ‚Ä¢ <strong>Tarif Horaire</strong> : Affich√© automatiquement pour les types flexibles<br/>
                        ‚Ä¢ Seuls les types de r√©servation s√©lectionn√©s dans l'onglet "Types de R√©servation" sont disponibles<br/>
                        ‚Ä¢ Utilisez le bouton "Tarifications" pour une vue d√©taill√©e
                    </div>
                </page>
            </xpath>
        </field>
    </record>
</odoo>