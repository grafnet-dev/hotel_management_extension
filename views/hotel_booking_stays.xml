<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!--List View -->
    <record id="hotel_booking_stay_list_view" model="ir.ui.view">
        <field name="name">hotel.booking.stay.list</field>
        <field name="model">hotel.booking.stay</field>
        <field name="arch" type="xml">
            <list string="S√©jours de R√©servation"
                decoration-info="state=='pending'"
                decoration-success="state in ('ongoing')"
                decoration-warning="state=='ongoing'"
                decoration-muted="state in ('completed','cancelled')">


                <field name="booking_id" string="N¬∞ R√©servation" />
                <field name="room_type_id" string="Type de Chambre" />
                <field name="occupant_names" string="Occupants" />
                <field name="planned_checkin_date" string="Arriv√©e Pr√©vue" />
                <field name="planned_checkout_date" string="D√©part Pr√©vu" />
                <field name="actual_checkin_date" string="Arriv√©e Effective"
                    invisible="not early_checkin_requested" />
                <field name="actual_checkout_date" string="D√©part Effectif"
                    invisible="not late_checkout_requested" />
                <field name="request_type" string="Type Demande" />
                <field name="difference_hours" string="√âcart (h)" readonly="1" />


                <field name="uom_qty" string="Dur√©e (jours)" />
                <field name="reservation_type_id" string="Type" />
                <field name="room_price_total" string="Prix Chambre" />
                <field name="pricing_rule_id" string="R√®gle Tarifaire" />
                <field name="price_total" string="Montant Total" sum="Total" />
                <field name="currency_id" invisible="1" />
                <field name="state" string="√âtat" widget="badge"
                    decoration-info="state=='pending'"
                    decoration-success="state=='ongoing'"
                    decoration-muted="state in ('completed','cancelled')" />

                <field name="extra_night_required" string="Nuit Extra" widget="boolean_toggle" />


            </list>
        </field>
    </record>

    <!-- Form View -->
    <record id="hotel_booking_stay_form_view" model="ir.ui.view">
        <field name="name">hotel.booking.stay.form</field>
        <field name="model">hotel.booking.stay</field>
        <field name="arch" type="xml">
            <form string="S√©jour de R√©servation">
                <header>
                    <field name="state" widget="statusbar"
                        statusbar_visible="pending,ongoing,completed,cancelled" />

                    <button name="action_start_checkin_wizard" type="object"
                        string="üè® D√©marrer le S√©jour"
                        invisible="state != 'pending'" />

                    <button name="action_checkout" type="object"
                        string="Check-out"
                        invisible="state != 'ongoing'" />

                    <button name="action_open_police_form" type="object"
                        string="üìù Fiche de police" />

                    <button name="action_print_police_form"
                        type="object"
                        string="üìù Imprimer Fiche de police" />

                    <button name="action_preview_police_form"
                        type="object"
                        string="Voir Fiche Police"
                        class="btn-secondary" />
                    <!--button
                    name="action_create_invoice"
                        string="Cr√©er la facture"
                        type="object"
                        class="btn-primary"
                        invisible="state != 'ongoing'" /-->

                    <button name="action_create_and_open_invoice"
                        string="Cr√©er et ouvrir la facture"
                        type="object"
                        class="btn-secondary"
                        invisible="state != 'ongoing'" />
                    <button name="action_view_invoice"
                        string="Voir la facture"
                        type="object"
                        class="btn-outline-secondary"
                    />


                    <button name="action_cancel" type="object"
                        string="Annuler"
                        invisible="not (state in ['pending','ongoing'])"
                        confirm="√ätes-vous s√ªr de vouloir annuler ce s√©jour ?" />
                </header>

                <sheet>


                    <div class="oe_title">
                        <label for="room_type_id" class="oe_edit_only" />
                        <h1>
                            <field name="room_type_id" placeholder="S√©lectionner un Type de Chambre"
                                class="o_text_overflow" />
                        </h1>
                        <h2 class="o_row">
                            <field name="occupant_names" placeholder="Occupants non d√©finis"
                                class="text-muted" />
                        </h2>
                    </div>


                    <!-- Informations principales  -->
                    <group>
                        <group name="booking_info" string="üìã Informations de Base">
                            <field name="booking_id"
                                string="R√©servation"
                               
                                options="{'no_create': False, 'no_create_edit': False}" />
                            <field name="reservation_type_id" required="1"
                                options="{'no_create': True, 'no_create_edit': True}" />
                        </group>

                        <group name="occupants_info" string="üë• Occupants">
                            <field name="occupant_ids" widget="many2many_tags"
                                placeholder="S√©lectionner les occupants"
                                options="{'color_field': 'color', 'no_create_edit': True}" />

                            <field name="room_id"
                                domain="[('room_type_id', '=', room_type_id)]"
                                options="{'no_create_edit': True}" />

                        </group>
                        <group>
                            <field name="product_id" />

                        </group>
                    </group>

                    <notebook>
                        <!-- Page Dates -->
                        <page string="üìÖ Dates &amp; Horaires" name="dates_times">
                            <group>
                                <group name="booking_dates" string="P√©riode de R√©servation">
                                    <field name="booking_start_date" string="Date de D√©but"
                                        invisible="is_flexible_reservation"
                                        required="not is_flexible_reservation" />
                                    <field name="booking_end_date" string="Date de Fin"
                                        invisible="is_flexible_reservation"
                                        required="not is_flexible_reservation" />
                                </group>

                                <group name="dates_group" string="Dates R√©servation">
                                    <field name="planned_checkin_date"
                                        string="Arriv√©e Pr√©vue"
                                        readonly="not is_flexible_reservation" />
                                    <field name="planned_checkout_date"
                                        string="D√©part Pr√©vu"
                                        readonly="not is_flexible_reservation" />

                                    <separator string="‚úî Effectifs"
                                        invisible="not (early_checkin_requested or late_checkout_requested)" />
                                    <field name="actual_checkin_date" string="Arriv√©e Effective"
                                        invisible="not early_checkin_requested" readonly="1" />
                                    <field name="actual_checkout_date" string="D√©part Effectif"
                                        invisible="not late_checkout_requested" readonly="1" />
                                </group>

                            </group>


                            <!-- EC/LC-->

                            <group string="‚è∞ Demandes Sp√©ciales Early / Late" name="ec_lc_group"
                                colspan="2">
                                <group>
                                    <field name="early_checkin_requested"
                                        string="Arriv√©e Anticip√©e ?" />
                                    <field name="requested_checkin_datetime"
                                        string="Heure Arriv√©e Demand√©e"
                                        invisible="not early_checkin_requested" />

                                    <field name="late_checkout_requested" string="D√©part Tardif ?" />
                                    <field name="requested_checkout_datetime"
                                        string="Heure D√©part Demand√©e"
                                        invisible="not late_checkout_requested" />
                                </group>

                                <group>
                                    <field name="difference_hours" string="√âcart demand√© (heures)"
                                        readonly="1" />
                                    <field name="extra_night_required"
                                        string="Nuit Suppl√©mentaire ?"
                                        widget="boolean_toggle" readonly="1" />
                                </group>

                            </group>


                            <!-- Champs techniques cach√©s -->
                            <group invisible="1">
                                <field name="is_flexible_reservation" />
                            </group>
                        </page>


                        <!--   <page string="üõéÔ∏è Services &amp; Consommations" name="services">

                            <group name="service_activation" string="Services Requis"
                                invisible="state not in ('pending', 'ongoing')">
                                <group>
                                    <field name="need_food" string="üçΩÔ∏è Restauration" />
                                    <field name="need_fleet" string="üöó V√©hicules" />
                                </group>
                                <group>
                                    <field name="need_service" string="üßπ Services" />
                                    <field name="need_event" string="üéâ √âv√©nements" />
                                </group>
                            </group>


                            <separator />


                            <group string="üçΩÔ∏è Consommations de Restauration"
                                invisible="not need_food">
                                <field name="food_order_line_ids" nolabel="1">
                                    <list editable="bottom" decoration-muted="price_subtotal == 0">
                                        <field name="food_id" string="Article" />
                                        <field name="uom_qty" string="Quantit√©" />
                                        <field name="price_unit" string="Prix Unit." />
                                        <field name="price_subtotal" string="Sous-total"
                                            sum="Total Restauration" />
                                    </list>
                                    <form>
                                        <group>
                                            <field name="food_id" />
                                            <field name="uom_qty" />
                                            <field name="price_unit" />
                                            <field name="price_subtotal" readonly="1" />
                                        </group>
                                    </form>
                                </field>
                            </group>


                            <group string="üöó Services de Transport"
                                invisible="not need_fleet">
                                <field name="fleet_booking_line_ids" nolabel="1">
                                    <list editable="bottom" decoration-muted="price_subtotal == 0">
                                        <field name="fleet_id" string="V√©hicule" />
                                        <field name="uom_qty" string="Dur√©e/Km" />
                                        <field name="price_unit" string="Tarif" />
                                        <field name="price_subtotal" string="Sous-total"
                                            sum="Total Transport" />
                                    </list>
                                    <form>
                                        <group>
                                            <field name="fleet_id" />
                                            <field name="uom_qty" />
                                            <field name="price_unit" />
                                            <field name="price_subtotal" readonly="1" />
                                        </group>
                                    </form>
                                </field>
                            </group>


                            <group string="üéâ √âv√©nements &amp; Activit√©s"
                                invisible="not need_event">
                                <field name="event_booking_line_ids" nolabel="1">
                                    <list editable="bottom" decoration-muted="price_subtotal == 0">
                                        <field name="event_id" string="√âv√©nement" />
                                        <field name="ticket_id" string="Type de Ticket" />
                                        <field name="uom_qty" string="Quantit√©" />
                                        <field name="price_unit" string="Prix Unit." />
                                        <field name="price_subtotal" string="Sous-total"
                                            sum="Total √âv√©nements" />
                                    </list>
                                    <form>
                                        <group>
                                            <field name="event_id" />
                                            <field name="ticket_id" />
                                            <field name="uom_qty" />
                                            <field name="price_unit" />
                                            <field name="price_subtotal" readonly="1" />
                                        </group>
                                    </form>
                                </field>
                            </group>
                        </page>-->


                    </notebook>


                </sheet>


            </form>
        </field>
    </record>

    <!-- Search View  -->
    <record id="hotel_booking_stay_search_view" model="ir.ui.view">
        <field name="name">hotel.booking.stay.search</field>
        <field name="model">hotel.booking.stay</field>
        <field name="arch" type="xml">
            <search string="Rechercher S√©jours">
                <!-- Champs de recherche principaux -->
                <field name="booking_id" string="N¬∞ R√©servation" />
                <field name="room_type_id" string="Type de Chambre" />
                <field name="occupant_ids" string="Occupants" />
                <field name="occupant_names" string="Noms des Occupants" />
                <field name="reservation_type_id" string="Type de R√©servation" />
                <field name="planned_checkin_date" string="Date d'Arriv√©e" />
                <field name="planned_checkout_date" string="Date de D√©part" />
                <field name="actual_checkin_date" string="Arriv√©e Effective" />
                <field name="actual_checkout_date" string="D√©part Effectif" />


                <!-- Filtres par p√©riode -->
                <separator />
                <filter string="üóìÔ∏è Aujourd'hui" name="today"
                    domain="[('booking_start_date', '=', context_today())]" />
                <filter string="üìÖ Cette Semaine" name="this_week"
                    domain="[('booking_start_date', '&gt;=', context_today()), 
                                ('booking_start_date', '&lt;', (context_today() + relativedelta(days=7)))]" />
                <filter string="üìÜ Ce Mois" name="this_month"
                    domain="[('booking_start_date', '&gt;=', context_today().replace(day=1)), 
                                ('booking_start_date', '&lt;', (context_today().replace(day=1) + relativedelta(months=1)))]" />

                <!-- Filtres par options sp√©ciales -->
                <separator />
                <filter string="‚è∞ Arriv√©e Anticip√©e" name="early_checkin"
                    domain="[('early_checkin_requested', '=', True)]" />
                <filter string="üïê D√©part Tardif" name="late_checkout"
                    domain="[('late_checkout_requested', '=', True)]" />

                <filter string="üåô Nuit Extra" name="extra_night"
                    domain="[('extra_night_required', '=', True)]" />

                <filter string="üåô Nuit Suppl√©mentaire" name="extra_night"
                    domain="[('extra_night_required', '=', True)]" />


                <!-- Filtres par √©tat -->
                <separator />
                <filter string="üìù En attente" name="pending" domain="[('state', '=', 'pending')]" />
                <filter string="üè® En Cours" name="ongoing" domain="[('state', '=', 'ongoing')]" />
                <filter string="‚úÖ Termin√©" name="completed" domain="[('state', '=', 'completed')]" />
                <filter string="‚ùå Annul√©" name="cancelled" domain="[('state', '=', 'cancelled')]" />


                <!-- Groupements -->
                <group expand="0" string="Regrouper Par">
                    <filter string="R√©servation" name="group_booking"
                        context="{'group_by': 'booking_id'}" />
                    <filter string="Type de Chambre" name="group_room"
                        context="{'group_by': 'room_type_id'}" />
                    <filter string="Type de R√©servation" name="group_reservation_type"
                        context="{'group_by': 'reservation_type_id'}" />
                    <filter string="√âtat" name="group_state"
                        context="{'group_by': 'state'}" />
                    <filter string="Date de R√©servation" name="group_booking_start_date"
                        context="{'group_by': 'booking_start_date:month'}" />
                </group>
            </search>
        </field>
    </record>

    <!-- Action  -->
    <record id="action_hotel_booking_stay" model="ir.actions.act_window">
        <field name="name">S√©jours de R√©servation</field>
        <field name="res_model">hotel.booking.stay</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_today': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üè® Cr√©er un nouveau s√©jour de r√©servation
            </p>
            <p> G√©rez les s√©jours individuels pour chaque r√©servation de chambre.<br /> Vous pouvez
                d√©finir les occupants, les dates, les services et suivre l'√©tat de chaque s√©jour. </p>
            <p>
                <strong>Fonctionnalit√©s disponibles :</strong>
            </p>
            <ul>
                <li>‚úÖ Gestion des check-in/check-out</li>
                <li>‚è∞ Options Early/Late</li>
                <li>üõéÔ∏è Services compl√©mentaires</li>
                <li>üí∞ Suivi financier d√©taill√©</li>
            </ul>
        </field>
    </record>

    <!-- Menu Item -->
    <menuitem
        id="menu_hotel_booking_stay"
        name="S√©jours de R√©servation"
        parent="hotel_management_odoo.hotel_config_menu"
        action="action_hotel_booking_stay"
        sequence="10" />

</odoo>