<?xml version="1.0" encoding="UTF-8"?>
<odoo noupdate="1">

    <!-- Tâche planifiée : calcul quotidien des métriques hôtelières -->
    <record id="ir_cron_compute_hotel_metrics_daily" model="ir.cron">
        <field name="name">Calcul quotidien des métriques hôtelières</field>
        <field name="model_id" ref="hotel_management_extension.model_hotel_metric"/>
        <field name="state">code</field>
        <field name="code">model._compute_metrics_for_date(fields.Date.today())</field>

        <!-- Fréquence : chaque jour -->
        <field name="interval_number">1</field>
        <field name="interval_type">days</field>

        <!-- Heure de départ : demain à 2h du matin -->
        <field name="nextcall" eval="(datetime.now() + timedelta(days=1)).replace(hour=2, minute=0, second=0, microsecond=0).strftime('%Y-%m-%d %H:%M:%S')"/>

        <!-- Utilisateur système -->
        <field name="user_id" ref="base.user_root"/>

        <!-- Activer la tâche -->
        <field name="active" eval="True"/>
    </record>

</odoo>